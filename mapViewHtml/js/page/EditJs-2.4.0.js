/*
EditJs-2.4.0 code for exsun

Copyright©2015-2018 武汉依迅北斗空间技术有限公司 All Rights Reserved.

http://www.exsun.cn
*/




var jsFunc=function(){L.MapLib={},L.MapLib.MapMaster={},L.MapLib.MapMaster.vertion="0.0.1",L.MapLib.MapMaster.TileProvider={oTianDiTu:{oNormal:{cName:"天地图",cMap:"http://t{s}.tianditu.cn/DataServer?T=vec_w&X={x}&Y={y}&L={z}",cAnnotion:"http://t{s}.tianditu.cn/DataServer?T=cva_w&X={x}&Y={y}&L={z}",acSubdomains:["0","1","2","3","4","5","6","7"]},oSatellite:{cName:"天地卫星图",cMap:"http://t{s}.tianditu.cn/DataServer?T=img_w&X={x}&Y={y}&L={z}",cAnnotion:"http://t{s}.tianditu.cn/DataServer?T=cia_w&X={x}&Y={y}&L={z}",acSubdomains:["0","1","2","3","4","5","6","7"]},oTerrain:{cName:"天地地形图",cMap:"http://t{s}.tianditu.cn/DataServer?T=ter_w&X={x}&Y={y}&L={z}",cAnnotion:"http://t{s}.tianditu.cn/DataServer?T=cta_w&X={x}&Y={y}&L={z}",acSubdomains:["0","1","2","3","4","5","6","7"]}},oMapABC:{oNormal:{cName:"MapABC",cMap:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",acSubdomains:["a","b","c"]}},oGaoDe:{oNormal:{cName:"高德地图",cMap:"http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oSatellite:{cName:"高德卫星图",cMap:"http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oNetRoad:{cName:"高德路网图",cMap:"http://webst0{s}.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]}},oExSun:{oNormal:{cName:"依迅地图",cMap:"http://title.comlbs.com/map/get/{x}/{y}/{z}",acSubdomains:["1","2","3","4"]},oNormalSvr:{cName:"依迅服务器图",cMap:"http://title.comlbs.com/mapimg.aspx?t=mapabc&z={z}&x={x}&y={y}",acSubdomains:["1","2","3","4"]}},oGoogleMap:{oNormal:{cName:"谷歌地图",cMap:"http://mt2.google.cn/vt/lyrs=m@167000000&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oSatellite:{cName:"谷歌卫星图",cMap:"http://mt3.google.cn/vt/lyrs=s&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oTopographic:{cName:"谷歌地形图",cMap:"http://mt0.google.cn/vt/lyrs=t&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",nMaxLevel:16,acSubdomains:["1","2","3","4"]}},oArcMap:{oFoursquare:{cMap:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}",cName:"灰度图",acSubdomains:["1","2","3","4"]}},oTDMap:{oNormal:{cName:"立体图",cMap:"https://a.tiles.mapbox.com/v3/foursquare.map-0y1jh28j/{z}/{x}/{y}.png",acSubdomains:["1","2","3","4"]}}},L.MapLib.MapMaster.TileProvider[0]=L.MapLib.MapMaster.TileProvider.oTianDiTu.oNormal,L.MapLib.MapMaster.TileProvider[1]=L.MapLib.MapMaster.TileProvider.oTianDiTu.oSatellite,L.MapLib.MapMaster.TileProvider[2]=L.MapLib.MapMaster.TileProvider.oTianDiTu.oTerrain,L.MapLib.MapMaster.TileProvider[3]=L.MapLib.MapMaster.TileProvider.oMapABC.oNormal,L.MapLib.MapMaster.TileProvider[4]=L.MapLib.MapMaster.TileProvider.oGaoDe.oNormal,L.MapLib.MapMaster.TileProvider[5]=L.MapLib.MapMaster.TileProvider.oGaoDe.oSatellite,L.MapLib.MapMaster.TileProvider[6]=L.MapLib.MapMaster.TileProvider.oGaoDe.oNetRoad,L.MapLib.MapMaster.TileProvider[7]=L.MapLib.MapMaster.TileProvider.oExSun.oNormal,L.MapLib.MapMaster.TileProvider[8]=L.MapLib.MapMaster.TileProvider.oExSun.oNormalSvr,L.MapLib.MapMaster.TileProvider[9]=L.MapLib.MapMaster.TileProvider.oGoogleMap.oNormal,L.MapLib.MapMaster.TileProvider[10]=L.MapLib.MapMaster.TileProvider.oGoogleMap.oSatellite,L.MapLib.MapMaster.TileProvider[11]=L.MapLib.MapMaster.TileProvider.oGoogleMap.oTopographic,L.MapLib.MapMaster.TileProvider[12]=L.MapLib.MapMaster.TileProvider.oArcMap.oFoursquare,L.MapLib.MapMaster.TileProvider[13]=L.MapLib.MapMaster.TileProvider.oTDMap.oNormal,L.MapLib.MapMaster.Err={1:"没有设置图层！",2:"Map parent container not found."},L.MapLib.MapMaster.EventName={loadFinish:"Map:loadFinish"},L.MapLib.MapMaster.Map=L.Evented.extend({options:{cDidId:"divMap",cDivContainerId:"divContainer",nDefaultTile:4,oMapOption:{zoomControl:!1,layers:[],center:new L.LatLng(31.17547255,115.00334782),zoom:13},oTileOption:{maxZoom:18,minZoom:3,attribution:'Map &copy;GB-20263—2018 <a target="_blank" href="#">电子地图</a> '},anLoadTile:[4,5,6,9,10,11,12],oProvider:L.MapLib.MapMaster.TileProvider,nMapWidth:1200,nMapHeight:550},cDiv:"div",initialize:function(t,e){return L.setOptions(this,e),this._oParent=t,this._oBaseLayer={},this._oDefaultTile=void 0,this._initTile(),this._getDefaultLayer(),this},getDefaultTile:function(){var t=this.options.oProvider[this.options.nDefaultTile].cName;return this._oBaseLayer[t]},loadMapMaster:function(){return this._loadMap(),this},getMap:function(){return this._oMap},getBaseLayers:function(){if(!this._oBaseLayer)throw new Error("地图瓦片图层为空");return this._oBaseLayer},_getDefaultLayer:function(){var t=this.options.oProvider[this.options.nDefaultTile].cName;return this._oDefaultTile=this._oBaseLayer[t],this._oDefaultTile},_loadMap:function(){var t=L.DomUtil.get(this.options.cDidId),e=null,i=null;if(e=this.nMapWidth,i=this.nMapHeight,!t){var a=L.DomUtil.get(this.options.cDivContainerId);if(!a)throw new Error("不存在地图加载容器");t=L.DomUtil.create(this.cDiv,"",a)}t.style.width=e+"px",t.style.height=i+"px",t.id=this.options.cDidId,L.Util.extend(this.options.oMapOption,{layers:[this._oDefaultTile]});var o=this._oMap=new L.Map(this.options.cDidId,this.options.oMapOption);return this._oParent&&(this._oParent.setMap&&this._oParent.setMap(o),this.fire("Map:loadFinish",{oMap:o})),o},_initTile:function(){var t=L.extend({},this.options.oTileOption),e=this.options.oProvider,i=this.options.anLoadTile;if(i&&!(i.length<=0)&&e){for(var a={},o=0;o<i.length;o++){var l=e[i[o]];t.maxZoom=l.nMaxLevel||t.maxZoom,t.minZoom=l.nMinLevel||t.minZoom,t.subdomains=l.acSubdomains;var n=L.tileLayer(l.cMap,t);a[l.cName]=n}this._oBaseLayer=a,this._oParent,this.fire("Map:loadTileFinish",{oBaseLayer:a})}},reflesh:function(t,e){if(this._oMap){var i=this._oMap.getContainer();t&&(i.style.width=t+"px"),e&&(i.style.height=e+"px"),this._oMap._onResize()}}}),L.MapLib.MapMaster.Map.include({cTopLeftConfig:{div:{class:"ex-layout-maptool ex-theme-maptool ex-map-top ex-map-left"}},cTopRightConfig:{div:{class:"ex-layout-maptool ex-theme-maptool ex-map-top ex-map-left"}},initTopLeft:function(t){L.DomUtil.get(this.options.cDidId)},initTopRight:function(){}}),L.MapLib.MapEditControl=L.Evented.extend({options:{cParentDiv:"MapView",acParentDivClass:["ex-layout-maptool","ex-theme-maptool","ex-map-top","ex-map-left","ex-maptool-edit"],cBtnContain:".ex-map-tool-edit",className:"",title:"图层编辑",oPenStyle:{stroke:!0,color:"#0FFF05",dashArray:null,lineCap:null,lineJoin:null,weight:3,opacity:1,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,smoothFactor:1,noClip:!1},oPenLineStyle:{stroke:!0,color:"#0FFF05",dashArray:null,lineCap:null,lineJoin:null,weight:3,opacity:1,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0,smoothFactor:1,noClip:!1}},initUI:function(){this.oTool=L.DomUtil.create("div","ex-maptool-box",this._oContainer),this.oUl=L.DomUtil.create("ul","ec-avg-sm-1 ex-map-tool-edit",this.oTool),this.liPlus=L.DomUtil.create("li","",this.oUl),this.liPlus.innerHTML='<i class="ec-icon-plus"></i>&nbsp;绘制',this.liPlus.href="javascript:void(0);",this.liEdit=L.DomUtil.create("li","",this.oUl),this.liEdit.innerHTML='<i class="ec-icon-pencil"></i>&nbsp;编&nbsp;&nbsp;辑',this.liEdit.href="javascript:void(0);",this.liDel=L.DomUtil.create("li","",this.oUl),this.liDel.innerHTML='<i class="ec-icon-power-off"></i>&nbsp;删&nbsp;&nbsp;除',this.liDel.href="javascript:void(0);",this.liSave=L.DomUtil.create("li","",this.oUl),this.liSave.innerHTML='<i class="ec-icon-save"></i>&nbsp;确&nbsp;&nbsp;定',this.liSave.href="javascript:void(0);",this.liCal=L.DomUtil.create("li","ex-map-tool-cancel",this.oUl),this.liCal.innerHTML='<i class="ec-icon-ban"></i>&nbsp;取&nbsp;&nbsp;消',this.liCal.href="javascript:void(0);",this.initEven(),this.liPlus.style.display="none",this.liEdit.style.display="none",this.liCal.style.display="none",this.liSave.style.display="none",this.liDel.style.display="none",this.dealEditUI()},initialize:function(t,e){L.extend(this,e),this.oPenStyle=this.options.oPenStyle,this.oPenLineStyle=this.options.oPenLineStyle,this._oMapBase=t.oMapMaster,this._oMap=t.oMapMaster._oMap,this._oParent=t,this._oDrawLayer=L.featureGroup(),this._oDrawLayer.addTo(this._oMap),this._oContainer=document.getElementsByClassName("ex-map-left")[0],this.cFlag="add",this.setParentEvent(),this.initPen(),this.initUI(),this.initCallBack(),this.initOn()},initOn:function(){this._oParent.on("ESMapEdit:showEditDraw",this.showEditAdd,this),this._oParent.on("ESMapEdit:clearLayers",this.clearLayers,this),this._oParent.on("ESMapEdit:deleteFence",this.deleteFence,this),this._oParent.on("ESMapEdit:editDraw",this.editDraw,this),this._oParent.on("ESMap:removeMap",this.removeMap,this)},removeMap:function(t){this._oMap&&this._oMap.remove()},editDraw:function(t){this.cFlag="edit";for(var e=[],i=t.aoLatLng,a=0;a<i.length;a++){var o=L.latLng(parseFloat(i[a].lat),parseFloat(i[a].lng));e.push(o)}if("polyline"==this._oParent.options.drawType)var l=L.polyline(e,this.oPenLineStyle).addTo(this._oDrawLayer);else var l=L.polygon(e,this.oPenStyle).addTo(this._oDrawLayer);l.cId=t.Id,l.oFenceInfo=t,l.bindTooltip(t.Name).openTooltip(),this.fitBound(),this.liPlus.style.display="none",this.liEdit.style.display="block",this.liCal.style.display="none",this.liSave.style.display="none",this.liDel.style.display="block",this.dealEditUI()},fitBound:function(){if(this._oDrawLayer){var t=this._oDrawLayer.getBounds();this._oMap.fitBounds(t)}},drawTip:function(t){var e={bIsNotEdit:!0,cName:"测试tip显示名称",oLatLng:{lat:30.333,lng:113.333},bNoHide:!0};L.extend(e,t);var i=new L.DivIcon({html:"<div> </div>",className:""}),a=L.marker(e.oLatLng,{icon:i,bIsNotEdit:e.bIsNotEdit});return a.cId=e.cId,a.bindLabel(e.cName,{noHide:e.bNoHide,direction:"auto"}),a},deleteFence:function(){this._oDrawLayer.clearLayers(),this.liCal.style.display="none",this.liEdit.style.display="none",this.dealEditUI()},clearLayers:function(){this._oDrawLayer.clearLayers(),this.liCal.style.display="none",this.dealEditUI()},showEditAdd:function(){this.cFlag="add",this.show(),this.clearLayers(),this.liPlus.click()},show:function(){this.oTool.style.display="block"},hide:function(){this.oTool.style.display="none"},dealEditUI:function(){for(var t=this.oTool.getElementsByTagName("li"),e=!1,i=0;i<t.length;i++)"none"!==L.DomUtil.getStyle(t[i],"display")&&(e=!0);e?this.show():this.hide()},_drawType:function(t){var e=null;switch(t){case"polygon":e={enabled:{shapeOptions:this.oPenStyle},handler:new L.Draw.Polygon(this._oMap,{shapeOptions:this.oPenStyle}),title:L.drawLocal.draw.toolbar.buttons.polygon};break;case"polyline":e={enabled:{shapeOptions:this.oPenLineStyle},handler:new L.Draw.Polyline(this._oMap,{shapeOptions:this.oPenLineStyle}),title:L.drawLocal.draw.toolbar.buttons.polyline};break;case"marker":e={enabled:{shapeOptions:this.oPenStyle},handler:new L.Draw.Marker(this._oMap,{shapeOptions:this.oPenStyle}),title:L.drawLocal.draw.toolbar.buttons.marker}}return e},initPen:function(){this.oDrawPen=this._drawType(this._oParent.options.drawType),this.oEditPen={enabled:this.oPenStyle,handler:new L.EditToolbar.Edit(this._oMap,{featureGroup:this._oDrawLayer,selectedPathOptions:{dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1},poly:{allowIntersection:!1}}),title:L.drawLocal.edit.toolbar.buttons.edit}},setParentEvent:function(){L.DomEvent.on(this._oContainer,"click",L.DomEvent.stopPropagation).on(this._oContainer,"dblclick",L.DomEvent.stopPropagation).on(this._oContainer,"mousemove",L.DomEvent.stopPropagation).on(this._oContainer,"mousewheel",L.DomEvent.stopPropagation).on(this._oContainer,"mousedown",L.DomEvent.stopPropagation).on(this._oContainer,"click",L.DomEvent.preventDefault)},initEven:function(){var t=this;L.DomEvent.on(this.liPlus,"click",function(){t.oDrawPen.handler.enable(),t.liPlus.style.display="none",t.liEdit.style.display="none",t.liCal.style.display="block",t.liSave.style.display="none",t.liDel.style.display="none",t.dealEditUI()},this),L.DomEvent.on(this.liSave,"click",function(){t.oEditPen.handler.save(),t.oEditPen.handler.disable(),t.liPlus.style.display="none",t.liEdit.style.display="none",t.liCal.style.display="none",t.liDel.style.display="block",t.dealEditUI()},this),L.DomEvent.on(this.liEdit,"click",function(){t.liPlus.style.display="none",t.liSave.style.display="block",t.liCal.style.display="block",t.liEdit.style.display="none",t.liDel.style.display="none",t.dealEditUI(),t.oEditPen.handler.enable()},this),L.DomEvent.on(this.liCal,"click",function(){this.liCal.style.display="none","add"===t.cFlag&&(t.liPlus.style.display="block",t.liSave.style.display="none",t.liCal.style.display="none",t.liEdit.style.display="none",t.liDel.style.display="none",t.clearLayers()),"edit"===t.cFlag&&(t.liPlus.style.display="none",t.liSave.style.display="none",t.liCal.style.display="none",t.liEdit.style.display="block",t.liDel.style.display="none"),t.oDrawPen.handler.disable(),t.oEditPen.handler.revertLayers(),t.oEditPen.handler.disable(),t.dealEditUI()},this),L.DomEvent.on(this.liDel,"click",function(){t.liDel.style.display="none","add"===t.cFlag&&(t.liPlus.style.display="none",t.liSave.style.display="none",t.liCal.style.display="none",t.liEdit.style.display="none",t.liDel.style.display="none"),"edit"===t.cFlag&&(t.liPlus.style.display="block",t.liSave.style.display="none",t.liCal.style.display="none",t.liEdit.style.display="none",t.liDel.style.display="none"),t.deleteFence(),t.dealEditUI()},this)},initCallBack:function(){var t=this;this._oMap.on("draw:created",function(e){var i=e.layer;t._oDrawLayer.addLayer(i);var a=t._getGisObj(i);t._oParent.fire("FenceView:UI.addFence",a)}),this._oMap.on("draw:edited",function(e){e.layers.eachLayer(function(e){var i=t._getGisObj(e);t._oDrawLayer.addLayer(e),i.cId=e.cId,i.oFenceInfo=e.oFenceInfo,t._oParent.fire("FenceView:UI.updateFence",i)})})},getDrawModeHandlers:function(){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(this._oMap,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:{shapeOptions:this.oPenStyle},handler:new L.Draw.Polygon(this._oMap,{shapeOptions:this.oPenStyle}),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(this._oMap,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(this._oMap,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(this._oMap,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker}]},getEditModeHandlers:function(){return[{enabled:this.oPenStyle,handler:new L.EditToolbar.Edit(this._oMap,{featureGroup:this._oDrawLayer,selectedPathOptions:this.options.edit.selectedPathOptions,poly:this.options.poly}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:{},handler:new L.EditToolbar.Delete(this._oMap,{featureGroup:this._oDrawLayer}),title:L.drawLocal.edit.toolbar.buttons.remove}]},_getGisObj:function(t){var e={},i=t.options;if(t instanceof L.Circle){var a=t.getLatLng();e={aoLatLng:[a,L.latLng([a.lat+t._getLatRadius(),a.lng])],dRadius:t.getRadius(),oOption:i,nType:this.getObjType(t),centerPoint:t.getCenter()}}else e={aoLatLng:t.getLatLngs(),oOption:i,nType:this.getObjType(t),centerPoint:t.getCenter()};return e},getObjType:function(t){return t instanceof L.Rectangle?3:t instanceof L.Polygon?1:t instanceof L.Polyline?4:t instanceof L.Circle?2:1},addFence:function(){this.liPlus.style.display="block",this.liEdit.style.display="none",this.liCal.style.display="none",this.liSave.style.display="none",this.dealEditUI()}}),L.MapLib.MapMaster.PopMap=L.Evented.extend({options:{parentContainer:null,mapId:null},initialize:function(t,e){L.setOptions(this,e),this._oParent=t,e.parentContainer&&(this.initUI(),e.parentContainer.appendChild(this.mapPanel))},initUI:function(){this.mapPanel=L.DomUtil.create("div","ex-layout-map-content"),this.mapPanel.id=this.options.mapId,this.topLeftPanel=L.DomUtil.create("div","ex-layout-maptool ex-theme-maptool ex-map-top ex-map-left",this.mapPanel),this.topRightPanel=L.DomUtil.create("div","ex-layout-maptool ex-theme-maptool ex-map-top ex-map-right",this.mapPanel),this.bottomLeftPanel=L.DomUtil.create("div","ex-layout-maptool ex-map-bottom ex-map-left",this.mapPanel),this.bottomRightPanel=L.DomUtil.create("div","ex-layout-maptool ex-theme-maptool ex-map-bottom ex-map-right",this.mapPanel)},loadMap:function(t,e){return this.oMapMaster=new L.MapLib.MapMaster.Map(this._oParent,{cDidId:this.options.mapId,oMapOption:{zoomControl:!1,layers:[],center:new L.LatLng(31.17547255,115.00334782),zoom:12}}),this.oMapMaster.nMapWidth=t,this.oMapMaster.nMapHeight=e,this.oMapMaster.loadMapMaster(),this.oMapMaster},resize:function(t,e){this.$_oContainer.width(t),this.$_oContainer.height(e),this.oMapMaster.reflesh(t,e)},loadMapToolArea:function(){this.oToolEdit=new L.MapLib.MapEditControl(this,{acParentDivClass:["ex-layout-maptool","ex-theme-maptool","ex-map-top","ex-map-right","ex-maptool-edit"]})}})}();